<script>

function initialize(tabId) {
  chrome.tabs.sendRequest(tabId, {}, function(coordinates_pair) {
    if (!coordinates_pair) {
      chrome.pageAction.hide(tabId);
    } else {
      chrome.pageAction.show(tabId);
    }
  });
}

// Ensure the current selected tab is set up.

chrome.tabs.onUpdated.addListener(function(tabId, change, tab) {
  if (change.status == "complete") {
    initialize(tabId);
  }
});

chrome.tabs.getSelected(null, function(tab) {
  initialize(tab.id);
});

</script>
